<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title>RGR Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .row { display: flex; gap: 24px; align-items: flex-start; flex-wrap: wrap; }
    .card { border: 1px solid #ddd; padding: 14px; border-radius: 10px; width: 50%; min-width: 360px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 6px; vertical-align: top; }
    input, select { padding: 6px; width: 100%; box-sizing: border-box; }
    .btn { padding: 6px 10px; cursor: pointer;}
    .muted { color: #666; font-size: 13px; }
    .danger { background: #fff0f0; }
  </style>
</head>
<body>

<h2>RGR — Gaming Championships</h2>

<!-- Повідомлення -->
<div th:if="${param.error}" class="danger card">
  Невірний логін або пароль.
</div>
<div th:if="${param.logout}" class="card">
  Ви вийшли з акаунта.
</div>

<!-- LOGIN (на тій же сторінці) -->
<div class="card" sec:authorize="isAnonymous()">
  <h3>Login</h3>
  <form method="post" action="/login">
    <label>Username</label>
    <input name="username" placeholder="admin або user" required>
    <label>Password</label>
    <input name="password" type="password" required>
    <button class="btn" type="submit">Sign in</button>
  </form>
</div>

<!-- DASHBOARD -->
<div sec:authorize="isAuthenticated()">
  <div class="card">
    <div>
      Ви увійшли як: <b sec:authentication="name"></b>
      (<span sec:authorize="hasRole('ADMIN')">ADMIN</span><span sec:authorize="hasRole('USER')">USER</span>)
    </div>
    <form method="post" action="/logout" style="margin-top:10px;">
      <button class="btn" type="submit">Logout</button>
    </form>
  </div>

  <div class="row" style="margin-top: 18px;">

    <!-- TEAMS -->
    <div class="card">
      <h3>Teams</h3>

      <div sec:authorize="hasRole('ADMIN')">
        <h4>Create team</h4>
        <form method="post" action="/ui/teams/create" th:object="${teamForm}">
          <input th:field="*{name}" placeholder="Name" required>
          <input th:field="*{city}" placeholder="City">
          <button class="btn" type="submit">Create</button>
        </form>
        <hr>
      </div>

      <table>
        <tr><th>ID</th><th>Name</th><th>City</th><th sec:authorize="hasRole('ADMIN')">Admin</th></tr>
        <tr th:each="t : ${teams}">
          <td th:text="${t.id()}"></td>
          <td th:text="${t.name()}"></td>
          <td th:text="${t.city()}"></td>

          <td sec:authorize="hasRole('ADMIN')">
            <form method="post" action="/ui/teams/update">
              <input type="hidden" name="id" th:value="${t.id()}">
              <input name="name" th:value="${t.name()}">
              <input name="city" th:value="${t.city()}">
              <button class="btn" type="submit">Save</button>
            </form>
            <form method="post" action="/ui/teams/delete" style="margin-top:6px;">
              <input type="hidden" name="id" th:value="${t.id()}">
              <button class="btn" type="submit">Delete</button>
            </form>
          </td>
        </tr>
      </table>
    </div>

    <!-- PARTICIPANTS -->
    <div class="card">
      <h3>Participants</h3>

      <div sec:authorize="hasRole('ADMIN')">
        <h4>Create participant</h4>
        <form method="post" action="/ui/participants/create" th:object="${participantForm}">
          <input th:field="*{firstName}" placeholder="First name" required>
          <input th:field="*{lastName}" placeholder="Last name" required>
          <input th:field="*{nickname}" placeholder="Nickname">
          <input th:field="*{teamId}" placeholder="Team ID (може бути пусто)">
          <button class="btn" type="submit">Create</button>
        </form>
        <hr>
      </div>

      <table>
        <tr>
          <th>ID</th><th>First</th><th>Last</th><th>Nick</th><th>TeamId</th>
          <th sec:authorize="hasRole('ADMIN')">Admin</th>
        </tr>
        <tr th:each="p : ${participants}">
          <td th:text="${p.id()}"></td>
          <td th:text="${p.firstName()}"></td>
          <td th:text="${p.lastName()}"></td>
          <td th:text="${p.nickname()}"></td>
          <td th:text="${p.teamId()}"></td>

          <td sec:authorize="hasRole('ADMIN')">
            <form method="post" action="/ui/participants/update">
              <input type="hidden" name="id" th:value="${p.id()}">
              <input name="firstName" th:value="${p.firstName()}">
              <input name="lastName" th:value="${p.lastName()}">
              <input name="nickname" th:value="${p.nickname()}">
              <input name="teamId" th:value="${p.teamId()}">
              <button class="btn" type="submit">Save</button>
            </form>
            <form method="post" action="/ui/participants/delete" style="margin-top:6px;">
              <input type="hidden" name="id" th:value="${p.id()}">
              <button class="btn" type="submit">Delete</button>
            </form>
          </td>
        </tr>
      </table>
    </div>

    <!-- CHAMPIONSHIPS -->
    <div class="card">
      <h3>Championships</h3>

      <div sec:authorize="hasRole('ADMIN')">
        <h4>Create championship</h4>
        <form method="post" action="/ui/championships/create" th:object="${championshipForm}">
          <input th:field="*{title}" placeholder="Title" required>
          <input th:field="*{game}" placeholder="Game" required>
          <input th:field="*{startDate}" placeholder="Start date (YYYY-MM-DD)">
          <input th:field="*{endDate}" placeholder="End date (YYYY-MM-DD)">
          <button class="btn" type="submit">Create</button>
        </form>
        <hr>
      </div>

      <table>
        <tr>
          <th>ID</th><th>Title</th><th>Game</th><th>Start</th><th>End</th><th>TeamIds</th>
          <th sec:authorize="hasRole('ADMIN')">Admin</th>
        </tr>
        <tr th:each="c : ${championships}">
          <td th:text="${c.id()}"></td>
          <td th:text="${c.title()}"></td>
          <td th:text="${c.game()}"></td>
          <td th:text="${c.startDate()}"></td>
          <td th:text="${c.endDate()}"></td>
          <td th:text="${c.teamIds()}"></td>

          <td sec:authorize="hasRole('ADMIN')">
            <form method="post" action="/ui/championships/update">
              <input type="hidden" name="id" th:value="${c.id()}">
              <input name="title" th:value="${c.title()}">
              <input name="game" th:value="${c.game()}">
              <input name="startDate" th:value="${c.startDate()}">
              <input name="endDate" th:value="${c.endDate()}">
              <button class="btn" type="submit">Save</button>
            </form>

            <form method="post" action="/ui/championships/delete" style="margin-top:6px;">
              <input type="hidden" name="id" th:value="${c.id()}">
              <button class="btn" type="submit">Delete</button>
            </form>

            <hr>
            <form method="post" action="/ui/championships/addTeam">
              <input type="hidden" name="championshipId" th:value="${c.id()}">
              <input name="teamId" placeholder="Team ID to add">
              <button class="btn" type="submit">Add team</button>
            </form>

            <form method="post" action="/ui/championships/removeTeam" style="margin-top:6px;">
              <input type="hidden" name="championshipId" th:value="${c.id()}">
              <input name="teamId" placeholder="Team ID to remove">
              <button class="btn" type="submit">Remove team</button>
            </form>
          </td>
        </tr>
      </table>
    </div>

  </div>
</div>

</body>
</html>
